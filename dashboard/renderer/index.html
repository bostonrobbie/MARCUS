<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src ws://localhost:* http://localhost:*; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
  <title>OpenClaw Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Top Bar -->
  <header id="topbar">
    <div class="topbar-left">
      <div class="status-dot" id="statusDot"></div>
      <span class="brand">OpenClaw</span>
      <span class="brand-sub">Dashboard</span>
      <span class="status-text" id="statusText">Connecting...</span>
    </div>
    <div class="topbar-center" id="agentStatus">
      <span class="run-state-badge run-state-idle" id="runStateBadge">idle</span>
      <span class="active-run-id" id="activeRunId"></span>
      <button id="btnPauseRun" class="btn-small btn-outline" style="display:none;" title="Pause">Pause</button>
      <button id="btnResumeRun" class="btn-small btn-outline" style="display:none;" title="Resume">Resume</button>
      <button id="btnStopRun" class="btn-small btn-danger" style="display:none;" title="Stop">Stop</button>
    </div>
    <div class="topbar-right">
      <span class="health-badge health-unknown" id="healthBadge" title="Platform health">--</span>
      <span class="tool-metrics-badge" id="toolMetricsBadge" title="Tool calls this session">0 calls</span>
      <button id="btnRunTests" class="btn-small btn-outline" title="Run Baseline Tests">Run Tests</button>
      <button id="btnReconnect" class="btn-small btn-outline" style="display:none;">Reconnect</button>
      <button id="btnStartGateway" class="btn-small btn-accent" style="display:none;">Start Gateway</button>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main">
    <!-- Chat Panel -->
    <section id="chatPanel" class="panel">
      <div class="panel-header">
        <span class="panel-title">Chat</span>
        <span class="panel-badge" id="sessionBadge">main</span>
        <button id="btnNewChat" class="btn-small btn-outline btn-new-chat" title="Start a fresh workspace (history is preserved)">+ New Chat</button>
      </div>
      <div id="chatMessages" class="chat-messages">
        <div class="chat-welcome">
          <div class="welcome-icon">&#x1F916;</div>
          <h2>OpenClaw Agent</h2>
          <p>Send a task and the agent will work on it autonomously.<br>Type a message below to get started.</p>
        </div>
      </div>
      <div id="chatStreaming" class="chat-streaming" style="display:none;">
        <div class="streaming-indicator">
          <div class="typing-dots"><span></span><span></span><span></span></div>
          <span class="streaming-label">Agent is working...</span>
        </div>
        <div id="streamingText" class="streaming-text"></div>
      </div>
      <div class="chat-input-area">
        <textarea id="chatInput" placeholder="Type a task for OpenClaw..." rows="1"></textarea>
        <button id="btnSend" class="btn-send" title="Send">&#x27A4;</button>
        <button id="btnAbort" class="btn-abort" title="Abort" style="display:none;">&#x2716;</button>
      </div>
    </section>

    <!-- Agentic Panel (tabbed) -->
    <section id="activityPanel" class="panel">
      <div class="panel-header tab-header">
        <div class="tab-bar">
          <button class="tab-btn active" data-tab="tasks">Tasks</button>
          <button class="tab-btn" data-tab="swarms">Swarms</button>
          <button class="tab-btn" data-tab="governance">Governance</button>
          <button class="tab-btn" data-tab="activity">Activity</button>
          <button class="tab-btn" data-tab="marcus">Marcus</button>
        </div>
        <div id="tabHeaderActions"></div>
      </div>

      <!-- Tasks Tab (default) -->
      <div id="tabTasks" class="tab-content active">
        <div id="tasksContent" class="tasks-feed">
          <div class="activity-empty"><p>No active tasks. Send a message or submit a task to see autonomous execution.</p></div>
        </div>
      </div>

      <!-- Swarms Tab -->
      <div id="tabSwarms" class="tab-content" style="display:none;">
        <div id="swarmsContent" class="swarms-feed">
          <div class="activity-empty"><p>No active swarms. Swarms launch when tasks require multi-agent coordination.</p></div>
        </div>
      </div>

      <!-- Governance Tab -->
      <div id="tabGovernance" class="tab-content" style="display:none;">
        <div id="governanceContent" class="governance-feed">
          <div class="activity-empty"><p>Governance data loads when connected.</p></div>
        </div>
        <div id="metricsPanel" class="metrics-panel"></div>
      </div>

      <!-- Activity Tab -->
      <div id="tabActivity" class="tab-content" style="display:none;">
        <div id="activityFeed" class="activity-feed">
          <div class="activity-empty">
            <p>Agent activity will appear here as tasks are processed.</p>
          </div>
        </div>
      </div>

      <!-- Marcus Research Tab -->
      <div id="tabMarcus" class="tab-content" style="display:none;">
        <div id="marcusContent" class="marcus-feed">
          <div class="activity-empty"><p>Loading Marcus Research data...</p></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Splash / Loading Overlay -->
  <div id="splashOverlay" class="splash-overlay" style="display:none;">
    <div class="splash-content">
      <div class="splash-spinner"></div>
      <h2>Starting OpenClaw Gateway...</h2>
      <p id="splashStatus">Checking health...</p>
    </div>
  </div>

  <!-- Approval Modal -->
  <div id="approvalOverlay" class="approval-overlay" style="display:none;">
    <div class="approval-card">
      <h3>Approval Required</h3>
      <div id="approvalCommand" class="approval-command"></div>
      <div id="approvalMeta" class="approval-meta"></div>
      <div class="approval-actions">
        <button id="btnApproveOnce" class="btn-small btn-accent">Allow Once</button>
        <button id="btnApproveAlways" class="btn-small btn-outline">Allow Always</button>
        <button id="btnDeny" class="btn-small btn-danger">Deny</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <div id="confirmOverlay" class="approval-overlay" style="display:none;">
    <div class="approval-card">
      <h3 id="confirmTitle">Confirm</h3>
      <p id="confirmMessage"></p>
      <div class="approval-actions">
        <button id="btnConfirmYes" class="btn-small btn-accent">Yes</button>
        <button id="btnConfirmNo" class="btn-small btn-outline">No</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
